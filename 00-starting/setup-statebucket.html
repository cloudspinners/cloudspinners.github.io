
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Set up a remote state bucket Â· CloudSpin Reference</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Kief Morris">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-asciidoc-admonition-icons/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="setup-iam-roles.html" />
    
    
    <link rel="prev" href="setup-aws.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    CloudSpin Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Tutorials</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="./">
            
                <a href="./">
            
                    
                    Getting started
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.1.1" data-path="stack-concept.html">
            
                <a href="stack-concept.html">
            
                    
                    Concept: What is a stack?
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.2" data-path="setup-workstation.html">
            
                <a href="setup-workstation.html">
            
                    
                    Set up your local tools
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.3" data-path="setup-aws.html">
            
                <a href="setup-aws.html">
            
                    
                    Bootstrap your AWS account
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="2.1.4" data-path="setup-statebucket.html">
            
                <a href="setup-statebucket.html">
            
                    
                    Set up a remote state bucket
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.1.5" data-path="setup-iam-roles.html">
            
                <a href="setup-iam-roles.html">
            
                    
                    Set up IAM roles
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../01-basic-stack/">
            
                <a href="../01-basic-stack/">
            
                    
                    Tutorial 01 - creating a simple stack
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.2.1" data-path="../01-basic-stack/stack-starting.html">
            
                <a href="../01-basic-stack/stack-starting.html">
            
                    
                    Creating a simple stack
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2.2" data-path="../01-basic-stack/stack-testing.html">
            
                <a href="../01-basic-stack/stack-testing.html">
            
                    
                    Testing the simple stack
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.3" data-path="../02-environments/todo.adoc">
            
                <span>
            
                    
                    Tutorial 02 - multiple environments
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.3.1" data-path="../02-environments/stack-multiple-instances.html">
            
                <a href="../02-environments/stack-multiple-instances.html">
            
                    
                    Creating multiple stack instances
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.3.2" data-path="../02-environments/stack-parameters.html">
            
                <a href="../02-environments/stack-parameters.html">
            
                    
                    Using parameters for stack instances
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.4" data-path="../03-aws-setup/">
            
                <a href="../03-aws-setup/">
            
                    
                    Tutorial 03 - setting up AWS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5" data-path="../04-pipelines/todo.adoc">
            
                <span>
            
                    
                    Tutorial 04 - Infrastructure pipeline for a stack
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.5.1" data-path="../04-pipelines/stack-pipelines.html">
            
                <a href="../04-pipelines/stack-pipelines.html">
            
                    
                    Delivering the stack using a pipeline
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5.2" data-path="../04-pipelines/pipeline-parameters.adoc">
            
                <span>
            
                    
                    Defining stack parameters in the pipeline
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5.3" data-path="../04-pipelines/todo.adoc">
            
                <span>
            
                    
                    Ephemeral stack testing stage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.5.4" data-path="../04-pipelines/todo.adoc">
            
                <span>
            
                    
                    Persistent stack testing stage
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.6" data-path="../05-split-stacks/">
            
                <a href="../05-split-stacks/">
            
                    
                    Tutorial 05 - Splitting infrastructure across stacks
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.6.1" data-path="../05-split-stacks/todo.adoc">
            
                <span>
            
                    
                    Shared VPC stack
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.6.2" data-path="../05-split-stacks/todo.adoc">
            
                <span>
            
                    
                    Tutorial 04 - Shared VPC stack
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="2.7" data-path="../example-project/todo.adoc">
            
                <span>
            
                    
                    Tutorial X - Data and persistence
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.8" data-path="../example-project/todo.adoc">
            
                <span>
            
                    
                    Tutorial X - Provisioning a server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.9" data-path="../example-project/todo.adoc">
            
                <span>
            
                    
                    Tutorial X - Testing server configuration definitions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.10" data-path="../example-project/todo.adoc">
            
                <span>
            
                    
                    Tutorial X - Building a server image
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.11" data-path="../example-project/todo.adoc">
            
                <span>
            
                    
                    Tutorial X - Configuration and dependency registry
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="2.11.1" data-path="../example-project/todo.adoc">
            
                <span>
            
                    
                    Defining stack parameters in a registry
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.11.2" data-path="../example-project/todo.adoc">
            
                <span>
            
                    
                    Using a registry for dependencies
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    
        
        <li class="header">Reference</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../reference/README.adoc">
            
                <span>
            
                    
                    Cloudspin Reference
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="../reference/cloudspin-project-structure.html">
            
                <a href="../reference/cloudspin-project-structure.html">
            
                    
                    Cloudspin project structure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="../reference/cloudspin-instance-configuration.html">
            
                <a href="../reference/cloudspin-instance-configuration.html">
            
                    
                    Cloudspin instance configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="../reference/cloudspin-stack-roles.html">
            
                <a href="../reference/cloudspin-stack-roles.html">
            
                    
                    Cloudspin stack roles
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4" data-path="../reference/stack-command-line.html">
            
                <a href="../reference/stack-command-line.html">
            
                    
                    Stack command line tool
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.5" data-path="../reference/cloudspin-ruby-api.html">
            
                <a href="../reference/cloudspin-ruby-api.html">
            
                    
                    Cloudspin Ruby classes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.6" data-path="../reference/cloudspin-rake.html">
            
                <a href="../reference/cloudspin-rake.html">
            
                    
                    Cloudspin Rake tasks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.7" data-path="../reference/cloudspin-artefacts.html">
            
                <a href="../reference/cloudspin-artefacts.html">
            
                    
                    Cloudspin Artefacts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.8" data-path="../reference/todo.adoc">
            
                <span>
            
                    
                    Terraform Statefiles with Cloudspin
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../reference/resources.adoc">
            
                <span>
            
                    
                    Resources
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.2.1" >
            
                <a target="_blank" href="https://cloudspin.io/">
            
                    
                    Cloudspin reference site
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.2" >
            
                <a target="_blank" href="https://github.com/cloudspinners/cloudspin-reference-examples">
            
                    
                    Example project source code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.3" >
            
                <a target="_blank" href="https://github.com/cloudspinners/cloudspin-reference">
            
                    
                    Source code for the reference documentation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.2.4" >
            
                <a target="_blank" href="https://github.com/cloudspinners/">
            
                    
                    Cloudspinners repositories on Github
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Set up a remote state bucket</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="create-a-remote-statebucket">Create a remote statebucket</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>The cloudspin example code is implemented in Terraform, which uses <a href="https://www.terraform.io/docs/state/" target="_blank">state files</a> to map the resources it manages to your project code.</p>
</div>
<div class="paragraph">
<p>There are various ways to manage Terraform state, in our case, we will store it in an S3 bucket. This preserves the state in the event that anything happens to your local files (e.g. accidentally deleting local statefiles). It also allows multiple people to work on the same infrastructure instances.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_state_for_your_statebucket">State for your statebucket</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Where does the statefile for the stack that manages your statefile bucket live? At the moment, this code manages the state for this locally.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_planning_and_creating_your_statebucket">Planning and creating your statebucket</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The folder <code>00-statebucket</code> has a cloudspin project that will create a statebucket for you. This uses the <a href="https://github.com/cloudspinners/spin-stack-s3bucket" target="_blank">s3bucket stack</a> definition. Here&#x2019;s how to do it.</p>
</div>
<div class="sect2">
<h3 id="__1_create_a_local_configuration_file">(1) Create a local configuration file</h3>
<div class="paragraph">
<p>Create a file <code>00-statebucket/stack-statebucket-local.yaml</code> (you can copy <code>00-statebucket/stack-statebucket-local-example.yaml</code> as a starter), and edit it:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yaml" data-lang="yaml"><span class="hljs-attr">instance:</span>
<span class="hljs-attr">  group:</span> YOURNAME_sandbox

<span class="hljs-attr">resources:</span>
<span class="hljs-attr">  aws_profile:</span> YOUR_BOOTSTRAP_CREDENTIALS_PROFILE</code></pre>
</div>
</div>
<div class="paragraph">
<p><em>YOUR_BOOTSTRAP_CREDENTIALS_PROFILE</em> will be the name of the profile in <code>~/.aws/credentials</code> with the bootstrap AWS API keys you created if you followed the steps in the <a href="00-starting/setup-aws.adoc">previous page</a>.</p>
</div>
<div class="paragraph">
<p>The <code>group</code> setting doesn&#x2019;t matter too much. It&#x2019;s essentially an ID for your environment, which, in more complex setups, can be used to integrate different things together. It is also used in tags.</p>
</div>
</div>
<div class="sect2">
<h3 id="__2_initialize_the_local_project_tooling">(2) Initialize the local project tooling</h3>
<div class="paragraph">
<p>In your <code>00-statebucket</code> folder, run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">bundle install</code></pre>
</div>
</div>
<div class="paragraph">
<p>This installs some Ruby gems that include the cloudspin tools we use in these examples. This is essentially a one-off, but when you want to update to newer versions of the tools, you&#x2019;d run <code>bundle update</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="__3_plan_the_bucket_creation">(3) Plan the bucket creation</h3>
<div class="paragraph">
<p>Now you can see what changes Terraform will make:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">rake plan</code></pre>
</div>
</div>
<div class="paragraph">
<p>This downloads the <a href="https://github.com/cloudspinners/spin-stack-s3bucket" target="_blank">cloudspin s3 bucket stack definition</a> code, and then runs <code>terraform plan</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="__4_create_the_bucket">(4) Create the bucket</h3>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-console" data-lang="console">rake up</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now you should have an S3 bucket that can be used for storing Terraform state. You&#x2019;ll need the name of the bucket to put into configuration for further examples. The name should be something like: <code>statebucket-cloudspin-examples-xxxxxxxxxxxx</code>, where the number at the end is your AWS account ID (which is needed to make sure the bucket name is globally unique).</p>
</div>
</div>
<div class="sect2">
<h3 id="_did_you_do_all_that">Did you do all that?</h3>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<div class="fa icon-caution" title="Caution">&#xF06D;</div>
</td>
<td class="content">
<div class="paragraph">
<p>If you&#x2019;ve simply followed all of these instructions without having a close look at the code they apply to your cloud account, you have potentially put yourself at risk. This project code could easily have been created by someone unscrupulous. Even if you trust me and know this is my project, someone else could have compromised my project code, and inserted code to exploit your AWS account.</p>
</div>
<div class="paragraph">
<p>You should make it a habit to carefully vet code before you download and apply it.</p>
</div>
<div class="paragraph">
<p>In this case, the Ruby gems will have been downloaded into your local Ruby library folder, and the Terraform code will have been downloaded to <code>./00-statebucket/.cloudspin</code>. I&#x2019;d encourage you to review this code and make sure you&#x2019;re comfortable with what it does before running it.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_next">What next?</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now you can proceed to <a href="00-starting/setup-iam-roles.adoc">setting up IAM roles</a> to use your AWS account a bit more securely.</p>
</div>
</div>
</div>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="setup-aws.html" class="navigation navigation-prev " aria-label="Previous page: Bootstrap your AWS account">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="setup-iam-roles.html" class="navigation navigation-next " aria-label="Next page: Set up IAM roles">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Set up a remote state bucket","level":"2.1.4","depth":2,"next":{"title":"Set up IAM roles","level":"2.1.5","depth":2,"path":"00-starting/setup-iam-roles.adoc","ref":"00-starting/setup-iam-roles.adoc","articles":[]},"previous":{"title":"Bootstrap your AWS account","level":"2.1.3","depth":2,"path":"00-starting/setup-aws.adoc","ref":"00-starting/setup-aws.adoc","articles":[]},"dir":"ltr"},"config":{"plugins":["asciidoc-admonition-icons"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"asciidoc-admonition-icons":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"Kief Morris","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"CloudSpin Reference","gitbook":"*"},"file":{"path":"00-starting/setup-statebucket.adoc","mtime":"2018-10-09T15:30:39.962Z","type":"asciidoc"},"gitbook":{"version":"3.2.3","time":"2018-10-09T15:51:01.416Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

