
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Using parameters for stack instances Â· CloudSpin Reference</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        <meta name="author" content="Kief Morris">
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-asciidoc-admonition-icons/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="stack-pipelines.html" />
    
    
    <link rel="prev" href="stack-multiple-instances.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="../README.md">
            
                <span>
            
                    
                    CloudSpin Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="./">
            
                <a href="./">
            
                    
                    Example project
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="examples-setup.html">
            
                <a href="examples-setup.html">
            
                    
                    Prerequisites
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="stack-starting.html">
            
                <a href="stack-starting.html">
            
                    
                    Creating a simple stack
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="stack-testing.html">
            
                <a href="stack-testing.html">
            
                    
                    Testing the simple stack
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="stack-multiple-instances.html">
            
                <a href="stack-multiple-instances.html">
            
                    
                    Creating multiple stack instances
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.3.5" data-path="stack-parameters.html">
            
                <a href="stack-parameters.html">
            
                    
                    Using parameters for stack instances
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="stack-pipelines.html">
            
                <a href="stack-pipelines.html">
            
                    
                    Delivering the stack using a pipeline
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="stack-roles.html">
            
                <a href="stack-roles.html">
            
                    
                    Using a stack definition for multiple roles
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../reference/README.adoc">
            
                <span>
            
                    
                    Cloudspin Reference
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../reference/cloudspin-project-structure.html">
            
                <a href="../reference/cloudspin-project-structure.html">
            
                    
                    Cloudspin project structure
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../reference/cloudspin-instance-configuration.html">
            
                <a href="../reference/cloudspin-instance-configuration.html">
            
                    
                    Cloudspin instance configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../reference/cloudspin-stack-roles.html">
            
                <a href="../reference/cloudspin-stack-roles.html">
            
                    
                    Cloudspin stack roles
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../reference/stack-command-line.html">
            
                <a href="../reference/stack-command-line.html">
            
                    
                    Stack command line tool
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../reference/cloudspin-ruby-api.html">
            
                <a href="../reference/cloudspin-ruby-api.html">
            
                    
                    Cloudspin Ruby classes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../reference/cloudspin-rake.html">
            
                <a href="../reference/cloudspin-rake.html">
            
                    
                    Cloudspin Rake tasks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../reference/cloudspin-artefacts.html">
            
                <a href="../reference/cloudspin-artefacts.html">
            
                    
                    Cloudspin Artefacts
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="../reference/resources.adoc">
            
                <span>
            
                    
                    Resources
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" >
            
                <a target="_blank" href="https://cloudspin.io/">
            
                    
                    Cloudspin reference site
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" >
            
                <a target="_blank" href="https://github.com/cloudspinners/cloudspin-reference-examples">
            
                    
                    Example project source code
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" >
            
                <a target="_blank" href="https://github.com/cloudspinners/cloudspin-reference">
            
                    
                    Source code for the reference documentation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" >
            
                <a target="_blank" href="https://github.com/cloudspinners/">
            
                    
                    Cloudspinners repositories on Github
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Using parameters for stack instances</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="using-parameters-for-stack-instances">Using parameters for stack instances</h1>
<div class="sect1">
<h2 id="_example_of_parameterized_infrastructure">Example of parameterized infrastructure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>I have an example of a <a href="https://github.com/kief/spin-template-standalone-service" target="_blank">parameterized infrastructure stack project</a> on github, using Terraform and AWS. Below is a (trimmed) snippet of code for a webserver.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-terraform" data-lang="terraform">resource &quot;aws_instance&quot; &quot;webserver&quot; {
  ...
  tags {
    Name                  = &quot;webserver-${var.service}-${var.component}-${var.deployment_id}&quot;
    DeploymentIdentifier  = &quot;${var.deployment_id}&quot;
    Service               = &quot;${var.service}&quot;
    Component             = &quot;${var.component}&quot;
  }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>This shows how it a number of variables are used to set tags, including a Name tag, to distinguish this server instance from other instances of the same server in other stack instances.</p>
</div>
<div class="paragraph">
<p>These variables are passed to the terraform command by a Makefile:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">TERRAFORM_VARS=\
  -var <span class="hljs-string">&quot;deployment_id=<span class="hljs-variable">$(DEPLOYMENT_ID)</span>&quot;</span> \
  -var <span class="hljs-string">&quot;component=<span class="hljs-variable">$(COMPONENT)</span>&quot;</span> \
  -var <span class="hljs-string">&quot;service=<span class="hljs-variable">$(SERVICE)</span>&quot;</span>

up: init <span class="hljs-comment">## Create or update the stack</span>
  terraform apply $(TERRAFORM_VARS) -auto-approve</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>SERVICE</code> and <code>COMPONENT</code> variables are set by a file in the stack definition project, and are always the same. The <code>DEPLOYMENT_ID</code> variable is passed to the Makefile when make is run. The pipeline stage configuration sets this, so for example, the production stage configuration (using AWS CodeBuild in this case) includes the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>resource &quot;aws_codebuild_project&quot; &quot;prodapply-project&quot; {
  name = &quot;${var.service}-${var.component}-${var.estate_id}-ApplyToProdEnvironment&quot;
  ...

  environment {
    environment_variable {
      &quot;name&quot;  = &quot;DEPLOYMENT_ID&quot;
      &quot;value&quot; = &quot;prod&quot;
    }
  }</pre>
</div>
</div>
<div class="paragraph">
<p>The codebuild project simply runs <code>make up</code>, and our stack definition creates our webserver instance accordingly.</p>
</div>
</div>
</div>
                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="stack-multiple-instances.html" class="navigation navigation-prev " aria-label="Previous page: Creating multiple stack instances">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="stack-pipelines.html" class="navigation navigation-next " aria-label="Next page: Delivering the stack using a pipeline">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Using parameters for stack instances","level":"1.3.5","depth":2,"next":{"title":"Delivering the stack using a pipeline","level":"1.3.6","depth":2,"path":"example-project/stack-pipelines.adoc","ref":"example-project/stack-pipelines.adoc","articles":[]},"previous":{"title":"Creating multiple stack instances","level":"1.3.4","depth":2,"path":"example-project/stack-multiple-instances.adoc","ref":"example-project/stack-multiple-instances.adoc","articles":[]},"dir":"ltr"},"config":{"plugins":["asciidoc-admonition-icons"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"asciidoc-admonition-icons":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","author":"Kief Morris","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"CloudSpin Reference","gitbook":"*"},"file":{"path":"example-project/stack-parameters.adoc","mtime":"2018-09-06T08:20:22.547Z","type":"asciidoc"},"gitbook":{"version":"3.2.3","time":"2018-09-13T09:06:21.194Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

